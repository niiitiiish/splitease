<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
        }
        
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow-x: hidden;
            font-family: 'Inter', sans-serif;
            @apply bg-gray-50 text-gray-800;
        }
        
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Custom scrollbar for horizontal group list */
        .groups-list::-webkit-scrollbar {
            height: 8px;
        }
        .groups-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .groups-list::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .groups-list::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Main layout container */
        .dashboard-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
            overflow: hidden;
        }

        .content-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 1rem;
            max-width: 100%;
        }

        /* Navbar fixes */
        .navbar {
            flex-shrink: 0;
            min-height: 60px;
            max-height: 60px;
        }

        /* Sidebar fixes */
        .sidebar {
            flex-shrink: 0;
            min-width: 60px;
            max-width: 120px;
        }

        /* Card and content sizing */
        .group-card {
            min-width: 280px;
            max-width: 400px;
            width: 100%;
        }

        .invitation-card {
            min-width: 250px;
            max-width: 350px;
            width: 100%;
        }

        .expense-card {
            width: 100%;
            max-width: 500px;
        }

        /* Responsive text sizing */
        .responsive-text {
            font-size: clamp(0.875rem, 2vw, 1rem);
        }

        .responsive-heading {
            font-size: clamp(1.5rem, 4vw, 2rem);
        }

        .responsive-subheading {
            font-size: clamp(1.25rem, 3vw, 1.5rem);
        }

        /* Mobile-first responsive design */
        .container-fluid {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
        }

        /* Extra small devices (phones, 320px and up) */
        @media (min-width: 320px) {
            .main-content {
                padding: 0.75rem;
            }
            
            .navbar {
                padding: 0.5rem 0.75rem;
            }
            
            .navbar-left span {
                font-size: 1.125rem;
            }
            
            .cards {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .card {
                padding: 1rem;
            }
            
            .card span {
                font-size: 1.75rem;
            }
            
            .group-card {
                min-width: 260px;
                padding: 0.75rem;
            }
            
            .invitation-card {
                min-width: 240px;
                padding: 0.75rem;
            }
            
            .expense-card {
                padding: 0.75rem;
            }
            
            .upi-section {
                padding: 0.75rem;
            }
            
            .add-group-form {
                padding: 0.75rem;
            }
        }

        /* Small devices (landscape phones, 576px and up) */
        @media (min-width: 576px) {
            .main-content {
                padding: 1rem;
            }
            
            .navbar {
                padding: 0.75rem 1rem;
            }
            
            .cards {
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .card span {
                font-size: 2rem;
            }
            
            .group-card {
                min-width: 300px;
                padding: 1rem;
            }
            
            .invitation-card {
                min-width: 280px;
                padding: 1rem;
            }
            
            .expense-card {
                padding: 1rem;
            }
            
            .upi-section {
                padding: 1rem;
            }
            
            .add-group-form {
                padding: 1rem;
            }
        }

        /* Medium devices (tablets, 768px and up) */
        @media (min-width: 768px) {
            .main-content {
                padding: 1.5rem;
            }
            
            .navbar {
                padding: 1rem 1.5rem;
            }
            
            .cards {
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
            }
            
            .card {
                padding: 2rem;
            }
            
            .card span {
                font-size: 2.5rem;
            }
            
            .group-card {
                min-width: 340px;
                padding: 1.5rem;
            }
            
            .invitation-card {
                min-width: 320px;
                padding: 1.5rem;
            }
            
            .expense-card {
                padding: 1.5rem;
            }
            
            .upi-section {
                padding: 1.5rem;
            }
            
            .add-group-form {
                padding: 1.5rem;
            }
            
            .sidebar {
                min-width: 70px;
            }
        }

        /* Large devices (desktops, 992px and up) */
        @media (min-width: 992px) {
            .main-content {
                padding: 2rem;
            }
            
            .navbar {
                padding: 1rem 2rem;
            }
            
            .cards {
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
            }
            
            .card {
                padding: 2.5rem;
            }
            
            .card span {
                font-size: 3rem;
            }
            
            .group-card {
                min-width: 380px;
                padding: 2rem;
            }
            
            .invitation-card {
                min-width: 340px;
                padding: 2rem;
            }
            
            .expense-card {
                padding: 2rem;
            }
            
            .upi-section {
                padding: 2rem;
            }
            
            .add-group-form {
                padding: 2rem;
            }
            
            .sidebar {
                min-width: 80px;
            }
        }

        /* Extra large devices (large desktops, 1200px and up) */
        @media (min-width: 1200px) {
            .main-content {
                padding: 2.5rem;
            }
            
            .navbar {
                padding: 1rem 2.5rem;
            }
            
            .cards {
                grid-template-columns: 1fr 1fr;
                gap: 2.5rem;
            }
            
            .card {
                padding: 3rem;
            }
            
            .card span {
                font-size: 3.5rem;
            }
            
            .group-card {
                min-width: 420px;
                padding: 2.5rem;
            }
            
            .invitation-card {
                min-width: 380px;
                padding: 2.5rem;
            }
            
            .expense-card {
                padding: 2.5rem;
            }
            
            .upi-section {
                padding: 2.5rem;
            }
            
            .add-group-form {
                padding: 2.5rem;
            }
            
            .sidebar {
                min-width: 100px;
            }
        }

        /* Ultra-wide screens (1400px and up) */
        @media (min-width: 1400px) {
            .main-content {
                padding: 3rem;
                max-width: 1400px;
                margin: 0 auto;
            }
            
            .group-card {
                min-width: 450px;
                padding: 3rem;
            }
        }

        /* Portrait orientation adjustments */
        @media (orientation: portrait) and (max-width: 768px) {
            .groups-list {
                flex-direction: column;
                overflow-x: visible;
                overflow-y: auto;
            }
            
            .group-card {
                width: 100%;
                min-width: unset;
                margin-bottom: 1rem;
            }
            
            .invitations-list {
                grid-template-columns: 1fr;
            }
            
            .invitation-card {
                width: 100%;
                min-width: unset;
            }
        }

        /* Landscape orientation adjustments */
        @media (orientation: landscape) and (max-height: 600px) {
            .navbar {
                padding: 0.5rem 1rem;
                min-height: 50px;
                max-height: 50px;
            }
            
            .main-content {
                padding: 0.75rem;
            }
            
            .card {
                padding: 1rem;
            }
            
            .card span {
                font-size: 1.5rem;
            }
        }

        /* High DPI displays */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .group-card,
            .invitation-card,
            .expense-card {
                border-width: 0.5px;
            }
        }

        /* Dark mode support (if user prefers) */
        @media (prefers-color-scheme: dark) {
            body {
                @apply bg-gray-900 text-gray-100;
            }
            
            .navbar,
            .sidebar,
            .group-card,
            .invitation-card,
            .expense-card,
            .upi-section,
            .add-group-form {
                @apply bg-gray-800 border-gray-700;
            }
            
            .card {
                @apply bg-gray-800;
            }
        }

        /* Reduced motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            .card,
            .group-card,
            .expense-card {
                transform: none;
                transition: none;
            }
        }

        /* Print styles */
        @media print {
            .navbar,
            .sidebar,
            .group-actions,
            .add-group-form {
                display: none;
            }
            
            .main-content {
                padding: 0;
            }
            
            .group-card,
            .invitation-card,
            .expense-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ccc;
            }
        }

        /* Overflow prevention */
        .overflow-safe {
            overflow-wrap: break-word;
            word-wrap: break-word;
            hyphens: auto;
        }

        .text-truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Ensure forms don't overflow */
        form {
            max-width: 100%;
        }

        input, button, select, textarea {
            max-width: 100%;
            box-sizing: border-box;
        }

        /* Modal overflow fix */
        #confirmationModal {
            overflow: hidden;
        }

        #confirmationModal > div {
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Navbar -->
        <div class="navbar bg-white shadow-sm py-4 px-6 flex justify-between items-center sticky top-0 z-10">
            <div class="navbar-left flex items-center space-x-3">
                <img src="static/splitease.png" alt="Spiltease Icon" class="h-8 w-8 sm:h-10 sm:w-10 rounded-full">
                <span class="text-xl sm:text-2xl font-semibold text-gray-900 overflow-safe">Spiltease</span>
            </div>
            <div class="navbar-right">
                <a href="/logout" class="text-gray-600 hover:text-red-500 transition-colors duration-200">
                    <i class="fas fa-power-off text-lg sm:text-xl"></i>
                </a>
            </div>
        </div>

        <div class="content-wrapper">
            <!-- Sidebar -->
            <nav class="sidebar bg-white shadow-md py-6 flex flex-col items-center border-r border-gray-100">
                <ul>
                    <li>
                        <a href="/dashboard" class="flex items-center justify-center p-3 rounded-lg text-gray-600 hover:bg-purple-100 hover:text-purple-700 transition-colors duration-200">
                            <i class="fas fa-home text-xl sm:text-2xl"></i>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Main Content -->
            <main class="main-content">
                <h1 class="responsive-heading font-bold text-gray-900 mb-4 sm:mb-6 overflow-safe">Welcome, {{ username }}!</h1>

                <!-- Message Display -->
                {% if msg %}
                <div class="bg-red-100 text-red-700 border border-red-200 px-4 sm:px-5 py-3 rounded-lg mb-4 sm:mb-6 text-sm overflow-safe" role="alert">
                    {{ msg }}
                </div>
                {% endif %}

                <!-- UPI Section -->
                {% set current_user = all_users|selectattr('username', 'equalto', username)|first %}
                <div class="upi-section bg-white rounded-lg shadow-sm mb-6 sm:mb-8 border border-gray-100">
                    <form method="post" action="/update-upi" class="flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4">
                        <label for="upi_id" class="text-base sm:text-lg font-medium text-gray-700 w-full sm:w-auto overflow-safe">Your UPI ID:</label>
                        <input type="text" id="upi_id" name="upi_id" value="{{ current_user.upi_id if current_user else '' }}" placeholder="your-upi@bank"
                               class="flex-1 px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-500 transition-all duration-200 w-full sm:w-auto text-sm sm:text-base">
                        <button type="submit" class="px-4 sm:px-6 py-2 bg-purple-600 text-white font-semibold rounded-lg shadow-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200 w-full sm:w-auto text-sm sm:text-base">
                            Update
                        </button>
                    </form>
                </div>

                <!-- Summary Cards -->
                <div class="cards grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 mb-8 sm:mb-10">
                    <div class="card bg-gradient-to-br from-purple-500 to-purple-700 text-white rounded-xl shadow-lg flex flex-col items-center justify-center transform hover:scale-105 transition-transform duration-300">
                        <div class="text-base sm:text-lg font-medium mb-2 opacity-90 overflow-safe">Total Owed</div>
                        <span class="text-2xl sm:text-3xl lg:text-4xl font-bold">₹{{ total_owed }}</span>
                    </div>
                    <div class="card bg-gradient-to-br from-green-500 to-green-700 text-white rounded-xl shadow-lg flex flex-col items-center justify-center transform hover:scale-105 transition-transform duration-300">
                        <div class="text-base sm:text-lg font-medium mb-2 opacity-90 overflow-safe">Total Lent</div>
                        <span class="text-2xl sm:text-3xl lg:text-4xl font-bold">₹{{ total_lent }}</span>
                    </div>
                </div>

                <!-- Pending Invitations Section -->
                {% if invitations %}
                <div class="invitations mb-8 sm:mb-10">
                    <h2 class="responsive-subheading font-bold text-gray-900 mb-4 sm:mb-5 overflow-safe">Pending Invitations</h2>
                    <div class="invitations-list grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                        {% for invite in invitations %}
                        <div class="invitation-card bg-white rounded-xl shadow-md border border-gray-100">
                            <div class="invitation-header flex items-center mb-3 sm:mb-4">
                                <i class="fas fa-envelope text-orange-500 text-lg sm:text-xl mr-2 sm:mr-3"></i>
                                <div class="overflow-safe">
                                    <h3 class="font-semibold text-gray-800 text-sm sm:text-base">Group Invitation</h3>
                                    <p class="text-xs sm:text-sm text-gray-500">You've been invited to join a group</p>
                                </div>
                            </div>
                            <div class="invitation-details mb-3 sm:mb-4">
                                <p class="text-gray-700 text-sm sm:text-base overflow-safe"><strong>Group:</strong> 
                                    {% set group = groups|selectattr('id', 'equalto', invite.group_id)|first %}
                                    {{ group.name if group else 'Unknown Group' }}
                                </p>
                            </div>
                            <form method="post" action="/dashboard/accept-invite" class="flex gap-2">
                                <input type="hidden" name="invite_id" value="{{ invite.id }}">
                                <button type="submit" class="flex-1 bg-green-500 text-white py-2 px-3 sm:px-4 rounded-lg font-semibold hover:bg-green-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm sm:text-base">
                                    <i class="fas fa-check"></i> <span>Accept</span>
                                </button>
                            </form>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Groups Section -->
                <div class="groups mb-8 sm:mb-10">
                    <h2 class="responsive-subheading font-bold text-gray-900 mb-4 sm:mb-5 overflow-safe">My Groups</h2>
                    {% if groups %}
                    <div class="groups-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6 mb-6">
                        {% for group in groups %}
                        <div class="group-card bg-white rounded-xl shadow-md border border-gray-100 hover:shadow-lg transition-shadow duration-300">
                            <div class="group-header p-4 sm:p-6 border-b border-gray-100">
                                <div class="group-title flex items-center text-lg sm:text-xl font-semibold text-gray-800 mb-2 overflow-safe">
                                    <i class="fas fa-users text-purple-600 mr-2 sm:mr-3 flex-shrink-0"></i> 
                                    <span class="text-truncate">{{ group.name }}</span>
                                </div>
                                <div class="group-meta text-xs sm:text-sm text-gray-500 flex items-center justify-between overflow-safe">
                                    <span><i class="fas fa-user-friends mr-1"></i> {{ group.members|length }} people</span>
                                    <span><i class="fas fa-rupee-sign mr-1"></i> ₹{{ group.expenses|map(attribute='amount')|sum|round(2) }}</span>
                                </div>
                            </div>
                            
                            <div class="group-content p-4 sm:p-6">
                                <!-- Members Summary -->
                                <div class="group-members mb-4">
                                    <h4 class="text-sm sm:text-base font-semibold text-gray-700 mb-2 overflow-safe">Members</h4>
                                    <div class="members-list space-y-2">
                                        {% set balances = group_balances[group.id] %}
                                        {% for member in group.members[:3] %}
                                        <div class="member-item flex items-center justify-between">
                                            <div class="flex items-center space-x-2 min-w-0 flex-1">
                                                <span class="member-initial bg-purple-100 text-purple-700 font-bold rounded-full h-6 w-6 sm:h-7 sm:w-7 flex items-center justify-center text-xs flex-shrink-0">{{ member.username[0]|upper }}</span>
                                                <span class="member-name text-gray-700 text-sm text-truncate overflow-safe">{{ member.username }}</span>
                                            </div>
                                            <span class="member-balance font-semibold text-xs sm:text-sm flex-shrink-0
                                                {% if balances[member.username] > 0 %}text-green-600{% elif balances[member.username] < 0 %}text-red-600{% else %}text-gray-500{% endif %}">
                                                {% if balances[member.username] > 0 %}+{% endif %}{{ balances[member.username]|round(2) }}
                                            </span>
                                        </div>
                                        {% endfor %}
                                        {% if group.members|length > 3 %}
                                        <div class="text-xs text-gray-500 text-center pt-1">
                                            +{{ group.members|length - 3 }} more members
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Recent Expenses -->
                                <div class="group-expenses mb-4">
                                    <h4 class="text-sm sm:text-base font-semibold text-gray-700 mb-2 overflow-safe">Recent Expenses</h4>
                                    <div class="expenses-list space-y-2">
                                        {% for expense in group.expenses[:2] %}
                                        <div class="expense-item flex justify-between items-center text-xs sm:text-sm">
                                            <div class="min-w-0 flex-1">
                                                <div class="text-gray-700 text-truncate overflow-safe">
                                                    <i class="fas fa-user mr-1 text-gray-500"></i> {{ expense.payer.username }}
                                                </div>
                                                <div class="text-gray-600 text-truncate overflow-safe">
                                                    <i class="fas fa-comment-dots mr-1 text-gray-500"></i> {{ expense.description }}
                                                </div>
                                            </div>
                                            <span class="font-bold text-purple-600 flex-shrink-0 ml-2">₹{{ expense.amount }}</span>
                                        </div>
                                        {% else %}
                                        <div class="text-gray-400 text-xs sm:text-sm text-center py-2">No expenses yet</div>
                                        {% endfor %}
                                    </div>
                                </div>

                                <!-- Settlement Status -->
                                <div class="settlement-status mb-4">
                                    <h4 class="text-sm sm:text-base font-semibold text-gray-700 mb-2 overflow-safe">Settlement Status</h4>
                                    {% set has_settlements = group.settlements|length > 0 %}
                                    {% if has_settlements %}
                                    <div class="text-xs sm:text-sm text-gray-600">
                                        <i class="fas fa-check-circle text-green-500 mr-1"></i>
                                        {{ group.settlements|length }} settlement{{ 's' if group.settlements|length != 1 else '' }} recorded
                                    </div>
                                    {% else %}
                                    <div class="text-xs sm:text-sm text-gray-500">
                                        <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                                        No settlements yet
                                    </div>
                                    {% endif %}
                                </div>

                                <!-- Quick Actions -->
                                <div class="group-actions space-y-2">
                                    <!-- Settlement Actions -->
                                    {% for owe in group.owes %}
                                        {% if owe.debtor.username == username %}
                                            {% set creditor_user = all_users|selectattr('username', 'equalto', owe.creditor.username)|first %}
                                            {% if creditor_user and creditor_user.upi_id %}
                                                <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 text-center">
                                                    <a href="upi://pay?pa={{ creditor_user.upi_id }}&pn={{ creditor_user.username }}&am={{ owe.amount }}&tn=SplitEase+Payment"
                                                       target="_blank" class="text-blue-700 font-bold hover:underline text-xs block mb-1 overflow-safe">
                                                        Pay ₹{{ owe.amount }} to {{ creditor_user.username }}
                                                    </a>
                                                    <div class="text-xs text-gray-500 overflow-safe">
                                                        Tap to pay via UPI
                                                    </div>
                                                </div>
                                            {% else %}
                                                <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-100 text-center">
                                                    <p class="text-yellow-700 text-xs overflow-safe">You owe {{ owe.creditor.username }} ₹{{ owe.amount }}</p>
                                                    <p class="text-yellow-600 text-xs mt-1 overflow-safe">Ask for UPI ID</p>
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                    
                                    <!-- Action Buttons -->
                                    <div class="flex flex-col space-y-2">
                                        <button onclick="toggleForm('expense-form-{{ group.id }}')" class="w-full bg-purple-500 text-white py-2 px-3 rounded-lg font-semibold hover:bg-purple-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-xs sm:text-sm">
                                            <i class="fas fa-plus-circle"></i> <span>Add Expense</span>
                                        </button>
                                        
                                        <button onclick="toggleForm('invite-form-{{ group.id }}')" class="w-full bg-indigo-500 text-white py-2 px-3 rounded-lg font-semibold hover:bg-indigo-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-xs sm:text-sm">
                                            <i class="fas fa-user-plus"></i> <span>Invite Friend</span>
                                        </button>
                                        
                                        <button onclick="showDeleteConfirm('delete-form-{{ group.id }}')" class="w-full bg-red-500 text-white py-2 px-3 rounded-lg font-semibold hover:bg-red-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-xs sm:text-sm">
                                            <i class="fas fa-trash"></i> <span>Delete Group</span>
                                        </button>
                                    </div>

                                    <!-- Hidden Forms -->
                                    <form id="expense-form-{{ group.id }}" method="post" action="/dashboard/add-expense" class="hidden space-y-2 p-3 bg-gray-50 rounded-lg border border-gray-200" onsubmit="this.querySelector('button[type=submit]').disabled=true;">
                                        <input type="hidden" name="group_id" value="{{ group.id }}">
                                        <input type="text" name="description" placeholder="Reason" required
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-purple-300 focus:border-purple-500 text-xs sm:text-sm">
                                        <input type="number" name="amount" placeholder="Amount" step="0.01" min="0" required
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-purple-300 focus:border-purple-500 text-xs sm:text-sm">
                                        <button type="submit" class="w-full bg-purple-600 text-white py-2 rounded-md font-semibold hover:bg-purple-700 transition-colors duration-200 text-xs sm:text-sm flex items-center justify-center space-x-2">
                                            <i class="fas fa-check"></i> <span>Add</span>
                                        </button>
                                    </form>
                                    
                                    <form id="invite-form-{{ group.id }}" method="post" action="/dashboard/invite-user" class="hidden space-y-2 p-3 bg-gray-50 rounded-lg border border-gray-200" onsubmit="this.querySelector('button[type=submit]').disabled=true;">
                                        <input type="hidden" name="group_id" value="{{ group.id }}">
                                        <input type="text" name="username" placeholder="Friend's username" required
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-indigo-300 focus:border-indigo-500 text-xs sm:text-sm">
                                        <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-md font-semibold hover:bg-indigo-700 transition-colors duration-200 text-xs sm:text-sm flex items-center justify-center space-x-2">
                                            <i class="fas fa-paper-plane"></i> <span>Invite</span>
                                        </button>
                                    </form>
                                    
                                    <form id="delete-form-{{ group.id }}" method="post" action="/dashboard/delete-group" class="hidden">
                                        <input type="hidden" name="group_id" value="{{ group.id }}">
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-8 sm:py-12">
                        <i class="fas fa-users text-gray-300 text-4xl sm:text-6xl mb-4"></i>
                        <h3 class="text-lg sm:text-xl font-semibold text-gray-600 mb-2 overflow-safe">No Groups Yet</h3>
                        <p class="text-gray-500 mb-4 sm:mb-6 text-sm sm:text-base overflow-safe">Create your first group to start splitting expenses with friends!</p>
                    </div>
                    {% endif %}
                    
                    <!-- Add Group Form -->
                    <form method="post" action="/dashboard/add-group" class="add-group-form flex flex-col sm:flex-row gap-3 mt-6 sm:mt-8 bg-white rounded-lg shadow-sm border border-gray-100 p-4 sm:p-6">
                        <input type="text" name="group_name" placeholder="New group name" required
                               class="flex-1 px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-500 transition-all duration-200 w-full sm:w-auto text-sm sm:text-base">
                        <button type="submit" class="px-4 sm:px-6 py-2 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 w-full sm:w-auto flex items-center justify-center space-x-2 text-sm sm:text-base">
                            <i class="fas fa-plus"></i> <span>Add Group</span>
                        </button>
                    </form>
                </div>

                <!-- Recent Expenses Section -->
                <div class="expenses">
                    <h2 class="responsive-subheading font-bold text-gray-900 mb-4 sm:mb-5 text-center overflow-safe">Recent Expenses</h2>
                    {% if expenses %}
                    <div class="expenses-list flex flex-col items-center gap-3 sm:gap-4">
                        {% for expense in expenses %}
                        <div class="expense-card bg-white rounded-xl shadow-md border border-gray-100 w-full transform hover:scale-[1.01] transition-transform duration-200"
                             title="Expense by {{ expense.payer.username }}" aria-label="Expense Card">
                            <div class="expense-header flex justify-between items-center mb-2 sm:mb-3 pb-2 sm:pb-3 border-b border-gray-100">
                                <span class="expense-payer text-base sm:text-lg font-semibold text-gray-800 flex items-center space-x-2 min-w-0 flex-1">
                                    <i class="fas fa-user text-purple-500 flex-shrink-0"></i> <span class="text-truncate overflow-safe">{{ expense.payer.username }}</span>
                                </span>
                                <span class="expense-amount text-xl sm:text-2xl font-bold text-purple-600 flex-shrink-0 ml-2">₹{{ expense.amount }}</span>
                            </div>
                            <div class="expense-body text-xs sm:text-sm text-gray-600 flex flex-col space-y-1">
                                <span class="expense-group flex items-center space-x-2">
                                    <i class="fas fa-users text-gray-500 flex-shrink-0"></i> <span class="text-truncate overflow-safe">{{ expense.group.name }}</span>
                                </span>
                                <span class="expense-reason flex items-center space-x-2">
                                    <i class="fas fa-comment-dots text-gray-500 flex-shrink-0"></i> <span class="text-truncate overflow-safe">{{ expense.description }}</span>
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-8 sm:py-12">
                        <i class="fas fa-receipt text-gray-300 text-4xl sm:text-6xl mb-4"></i>
                        <h3 class="text-lg sm:text-xl font-semibold text-gray-600 mb-2 overflow-safe">No Recent Expenses</h3>
                        <p class="text-gray-500 text-sm sm:text-base overflow-safe">Add some expenses to your groups to see them here!</p>
                    </div>
                    {% endif %}
                </div>
            </main>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-sm w-full text-center">
            <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4 overflow-safe">Confirm Action</h3>
            <p class="text-gray-600 mb-4 sm:mb-6 text-sm sm:text-base overflow-safe" id="modalMessage">Are you sure you want to proceed?</p>
            <div class="flex justify-center space-x-3 sm:space-x-4">
                <button id="cancelButton" class="px-4 sm:px-6 py-2 bg-gray-300 text-gray-800 rounded-lg font-semibold hover:bg-gray-400 transition-colors duration-200 text-sm sm:text-base">
                    Cancel
                </button>
                <button id="confirmButton" class="px-4 sm:px-6 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors duration-200 text-sm sm:text-base">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <script>
        // Function to toggle form visibility
        function toggleForm(id) {
            const el = document.getElementById(id);
            if (el) {
                el.classList.toggle('hidden');
            }
        }

        // Custom confirmation modal logic
        let currentFormToSubmit = null;

        function showDeleteConfirm(formId) {
            const modal = document.getElementById('confirmationModal');
            const modalMessage = document.getElementById('modalMessage');
            const confirmButton = document.getElementById('confirmButton');
            const cancelButton = document.getElementById('cancelButton');

            modalMessage.textContent = 'Are you sure you want to delete this group? This action cannot be undone.';
            currentFormToSubmit = document.getElementById(formId);

            modal.classList.remove('hidden');

            confirmButton.onclick = () => {
                if (currentFormToSubmit) {
                    currentFormToSubmit.submit();
                }
                modal.classList.add('hidden');
            };

            cancelButton.onclick = () => {
                modal.classList.add('hidden');
                currentFormToSubmit = null;
            };

            // Close modal if clicking outside
            modal.onclick = (event) => {
                if (event.target === modal) {
                    modal.classList.add('hidden');
                    currentFormToSubmit = null;
                }
            };
        }
    </script>
</body>
</html>
