<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-gray-50 text-gray-800;
        }
        
        /* Custom scrollbar for horizontal group list */
        .groups-list::-webkit-scrollbar {
            height: 8px;
        }
        .groups-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .groups-list::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .groups-list::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Mobile-first responsive design */
        .container-fluid {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
        }

        /* Extra small devices (phones, 320px and up) */
        @media (min-width: 320px) {
            .navbar {
                padding: 0.75rem 1rem;
            }
            
            .navbar-left span {
                font-size: 1.25rem;
            }
            
            .main {
                padding: 1rem;
            }
            
            .cards {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .card span {
                font-size: 2rem;
            }
            
            .group-card {
                width: 280px;
                padding: 1rem;
            }
            
            .invitation-card {
                padding: 1rem;
            }
            
            .expense-card {
                padding: 1rem;
            }
            
            .upi-section {
                padding: 1rem;
            }
            
            .upi-section form {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .add-group-form {
                flex-direction: column;
                gap: 0.75rem;
                padding: 1rem;
            }
        }

        /* Small devices (landscape phones, 576px and up) */
        @media (min-width: 576px) {
            .navbar {
                padding: 1rem 1.5rem;
            }
            
            .main {
                padding: 1.5rem;
            }
            
            .cards {
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
            }
            
            .card {
                padding: 2rem;
            }
            
            .card span {
                font-size: 2.5rem;
            }
            
            .group-card {
                width: 320px;
                padding: 1.5rem;
            }
            
            .invitation-card {
                padding: 1.5rem;
            }
            
            .expense-card {
                padding: 1.5rem;
            }
            
            .upi-section {
                padding: 1.5rem;
            }
            
            .upi-section form {
                flex-direction: row;
                gap: 1rem;
            }
            
            .add-group-form {
                flex-direction: row;
                gap: 1rem;
                padding: 1.5rem;
            }
        }

        /* Medium devices (tablets, 768px and up) */
        @media (min-width: 768px) {
            .navbar {
                padding: 1rem 2rem;
            }
            
            .main {
                padding: 2rem;
            }
            
            .cards {
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
            }
            
            .card {
                padding: 2.5rem;
            }
            
            .card span {
                font-size: 3rem;
            }
            
            .group-card {
                width: 360px;
                padding: 2rem;
            }
            
            .invitation-card {
                padding: 2rem;
            }
            
            .expense-card {
                padding: 2rem;
            }
            
            .upi-section {
                padding: 2rem;
            }
            
            .add-group-form {
                padding: 2rem;
            }
            
            .sidebar {
                width: 80px;
            }
        }

        /* Large devices (desktops, 992px and up) */
        @media (min-width: 992px) {
            .navbar {
                padding: 1rem 2.5rem;
            }
            
            .main {
                padding: 2.5rem;
            }
            
            .cards {
                grid-template-columns: 1fr 1fr;
                gap: 2.5rem;
            }
            
            .card {
                padding: 3rem;
            }
            
            .card span {
                font-size: 3.5rem;
            }
            
            .group-card {
                width: 400px;
                padding: 2.5rem;
            }
            
            .invitation-card {
                padding: 2.5rem;
            }
            
            .expense-card {
                padding: 2.5rem;
            }
            
            .upi-section {
                padding: 2.5rem;
            }
            
            .add-group-form {
                padding: 2.5rem;
            }
            
            .sidebar {
                width: 96px;
            }
        }

        /* Extra large devices (large desktops, 1200px and up) */
        @media (min-width: 1200px) {
            .navbar {
                padding: 1rem 3rem;
            }
            
            .main {
                padding: 3rem;
            }
            
            .cards {
                grid-template-columns: 1fr 1fr;
                gap: 3rem;
            }
            
            .card {
                padding: 3.5rem;
            }
            
            .card span {
                font-size: 4rem;
            }
            
            .group-card {
                width: 450px;
                padding: 3rem;
            }
            
            .invitation-card {
                padding: 3rem;
            }
            
            .expense-card {
                padding: 3rem;
            }
            
            .upi-section {
                padding: 3rem;
            }
            
            .add-group-form {
                padding: 3rem;
            }
            
            .sidebar {
                width: 120px;
            }
        }

        /* Ultra-wide screens (1400px and up) */
        @media (min-width: 1400px) {
            .container-fluid {
                max-width: 1400px;
                margin: 0 auto;
            }
            
            .main {
                padding: 3.5rem;
            }
            
            .group-card {
                width: 500px;
                padding: 3.5rem;
            }
        }

        /* Portrait orientation adjustments */
        @media (orientation: portrait) and (max-width: 768px) {
            .groups-list {
                flex-direction: column;
                overflow-x: visible;
                overflow-y: auto;
            }
            
            .group-card {
                width: 100%;
                margin-bottom: 1rem;
            }
            
            .invitations-list {
                grid-template-columns: 1fr;
            }
        }

        /* Landscape orientation adjustments */
        @media (orientation: landscape) and (max-height: 600px) {
            .navbar {
                padding: 0.5rem 1rem;
            }
            
            .main {
                padding: 1rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .card span {
                font-size: 2rem;
            }
        }

        /* High DPI displays */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .group-card,
            .invitation-card,
            .expense-card {
                border-width: 0.5px;
            }
        }

        /* Dark mode support (if user prefers) */
        @media (prefers-color-scheme: dark) {
            body {
                @apply bg-gray-900 text-gray-100;
            }
            
            .navbar,
            .sidebar,
            .group-card,
            .invitation-card,
            .expense-card,
            .upi-section,
            .add-group-form {
                @apply bg-gray-800 border-gray-700;
            }
            
            .card {
                @apply bg-gray-800;
            }
        }

        /* Reduced motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            .card,
            .group-card,
            .expense-card {
                transform: none;
                transition: none;
            }
        }

        /* Print styles */
        @media print {
            .navbar,
            .sidebar,
            .group-actions,
            .add-group-form {
                display: none;
            }
            
            .main {
                padding: 0;
            }
            
            .group-card,
            .invitation-card,
            .expense-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ccc;
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Navbar -->
    <div class="navbar bg-white shadow-sm py-4 px-6 flex justify-between items-center sticky top-0 z-10">
        <div class="navbar-left flex items-center space-x-3">
            <!-- Using a placeholder for the image, replace with actual path if available -->
            <img src="static/splitease.png" alt="Spiltease Icon" class="h-10 w-10 rounded-full">
            <span class="text-2xl font-semibold text-gray-900">Spiltease</span>
        </div>
        <div class="navbar-right">
            <a href="/logout" class="text-gray-600 hover:text-red-500 transition-colors duration-200">
                <i class="fas fa-power-off text-xl"></i>
            </a>
        </div>
    </div>

    <div class="flex flex-1">
        <!-- Sidebar -->
        <nav class="sidebar bg-white shadow-md w-16 md:w-20 lg:w-24 py-6 flex flex-col items-center border-r border-gray-100">
            <ul>
                <li>
                    <a href="/dashboard" class="flex items-center justify-center p-3 rounded-lg text-gray-600 hover:bg-purple-100 hover:text-purple-700 transition-colors duration-200">
                        <i class="fas fa-home text-2xl"></i>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main flex-1 p-6 md:p-8 lg:p-10">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-4 sm:mb-6">Welcome, {{ username }}!</h1>

            <!-- Message Display -->
            {% if msg %}
            <div class="bg-red-100 text-red-700 border border-red-200 px-4 sm:px-5 py-3 rounded-lg mb-4 sm:mb-6 text-sm" role="alert">
                {{ msg }}
            </div>
            {% endif %}

            <!-- UPI Section -->
            {% set current_user = all_users|selectattr('username', 'equalto', username)|first %}
            <div class="upi-section bg-white p-4 sm:p-6 rounded-lg shadow-sm mb-6 sm:mb-8 border border-gray-100">
                <form method="post" action="/update-upi" class="flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4">
                    <label for="upi_id" class="text-base sm:text-lg font-medium text-gray-700 w-full sm:w-auto">Your UPI ID:</label>
                    <input type="text" id="upi_id" name="upi_id" value="{{ current_user.upi_id if current_user else '' }}" placeholder="your-upi@bank"
                           class="flex-1 px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-500 transition-all duration-200 w-full sm:w-auto text-sm sm:text-base">
                    <button type="submit" class="px-4 sm:px-6 py-2 bg-purple-600 text-white font-semibold rounded-lg shadow-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200 w-full sm:w-auto text-sm sm:text-base">
                        Update
                    </button>
                </form>
            </div>

            <!-- Summary Cards -->
            <div class="cards grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 mb-8 sm:mb-10">
                <div class="card bg-gradient-to-br from-purple-500 to-purple-700 text-white p-4 sm:p-6 rounded-xl shadow-lg flex flex-col items-center justify-center transform hover:scale-105 transition-transform duration-300">
                    <div class="text-base sm:text-lg font-medium mb-2 opacity-90">Total Owed</div>
                    <span class="text-2xl sm:text-3xl lg:text-4xl font-bold">₹{{ total_owed }}</span>
                </div>
                <div class="card bg-gradient-to-br from-green-500 to-green-700 text-white p-4 sm:p-6 rounded-xl shadow-lg flex flex-col items-center justify-center transform hover:scale-105 transition-transform duration-300">
                    <div class="text-base sm:text-lg font-medium mb-2 opacity-90">Total Lent</div>
                    <span class="text-2xl sm:text-3xl lg:text-4xl font-bold">₹{{ total_lent }}</span>
                </div>
            </div>

            <!-- Pending Invitations Section -->
            {% if invitations %}
            <div class="invitations mb-8 sm:mb-10">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-4 sm:mb-5">Pending Invitations</h2>
                <div class="invitations-list grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                    {% for invite in invitations %}
                    <div class="invitation-card bg-white p-4 sm:p-6 rounded-xl shadow-md border border-gray-100">
                        <div class="invitation-header flex items-center mb-3 sm:mb-4">
                            <i class="fas fa-envelope text-orange-500 text-lg sm:text-xl mr-2 sm:mr-3"></i>
                            <div>
                                <h3 class="font-semibold text-gray-800 text-sm sm:text-base">Group Invitation</h3>
                                <p class="text-xs sm:text-sm text-gray-500">You've been invited to join a group</p>
                            </div>
                        </div>
                        <div class="invitation-details mb-3 sm:mb-4">
                            <p class="text-gray-700 text-sm sm:text-base"><strong>Group:</strong> 
                                {% set group = groups|selectattr('id', 'equalto', invite.group_id)|first %}
                                {{ group.name if group else 'Unknown Group' }}
                            </p>
                        </div>
                        <form method="post" action="/dashboard/accept-invite" class="flex gap-2">
                            <input type="hidden" name="invite_id" value="{{ invite.id }}">
                            <button type="submit" class="flex-1 bg-green-500 text-white py-2 px-3 sm:px-4 rounded-lg font-semibold hover:bg-green-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm sm:text-base">
                                <i class="fas fa-check"></i> <span>Accept</span>
                            </button>
                        </form>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Groups Section -->
            <div class="groups mb-8 sm:mb-10">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-4 sm:mb-5">My Groups</h2>
                {% if groups %}
                <div class="groups-list flex flex-nowrap gap-4 sm:gap-6 pb-4 overflow-x-auto">
                    {% for group in groups %}
                    <div class="group-card bg-white p-4 sm:p-6 rounded-xl shadow-md border border-gray-100 flex-shrink-0 w-72 sm:w-80 md:w-96 lg:w-[400px] xl:w-[450px]">
                        <div class="group-title flex items-center text-lg sm:text-xl font-semibold text-gray-800 mb-3">
                            <i class="fas fa-users text-purple-600 mr-2 sm:mr-3"></i> {{ group.name }}
                        </div>
                        <div class="group-meta text-xs sm:text-sm text-gray-500 mb-3 sm:mb-4 flex items-center space-x-2 sm:space-x-3">
                            <span><i class="fas fa-user-friends mr-1"></i> {{ group.members|length }} people</span>
                            <span>&bull;</span>
                            <span><i class="fas fa-rupee-sign mr-1"></i> ₹{{ group.expenses|map(attribute='amount')|sum|round(2) }} total</span>
                        </div>
                        <div class="group-members mb-3 sm:mb-4">
                            <b class="text-gray-700 text-sm sm:text-base block mb-2">Members</b>
                            <ul class="list-none p-0 m-0">
                                {% set balances = group_balances[group.id] %}
                                {% for member in group.members %}
                                <li class="member-row flex justify-between items-center py-1 sm:py-2 border-b border-gray-100 last:border-b-0">
                                    <div class="flex items-center space-x-2">
                                        <span class="member-initial bg-purple-100 text-purple-700 font-bold rounded-full h-6 w-6 sm:h-8 sm:w-8 flex items-center justify-center text-xs sm:text-sm">{{ member.username[0]|upper }}</span>
                                        <span class="member-name text-gray-700 text-sm sm:text-base">{{ member.username }}</span>
                                    </div>
                                    <span class="member-balance font-semibold text-xs sm:text-sm
                                        {% if balances[member.username] > 0 %}text-green-600{% elif balances[member.username] < 0 %}text-red-600{% else %}text-gray-500{% endif %}">
                                        {% if balances[member.username] > 0 %}+{% endif %}{{ balances[member.username]|round(2) }}
                                    </span>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="group-expenses mb-3 sm:mb-4">
                            <b class="text-gray-700 text-sm sm:text-base block mb-2">Recent Expenses</b>
                            <ul class="list-none p-0 m-0">
                                {% for expense in group.expenses[:3] %}
                                <li class="flex justify-between items-center py-1 sm:py-2 border-b border-gray-100 last:border-b-0 text-xs sm:text-sm">
                                    <div>
                                        <span class="block text-gray-700"><i class="fas fa-user mr-1 text-gray-500"></i> {{ expense.payer.username }}</span>
                                        <span class="block text-gray-600 text-xs"><i class="fas fa-comment-dots mr-1 text-gray-500"></i> {{ expense.description }}</span>
                                    </div>
                                    <span class="font-bold text-purple-600">₹{{ expense.amount }}</span>
                                </li>
                                {% else %}
                                <li class="text-gray-400 text-xs sm:text-sm py-1 sm:py-2">No expenses yet.</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="group-settlements mb-4 sm:mb-6">
                            <b class="text-gray-700 text-sm sm:text-base block mb-2">Settlement History</b>
                            <ul class="list-none p-0 m-0">
                                {% for settlement in group.settlements[:5] %}
                                {% set payer = all_users|selectattr('id', 'equalto', settlement.payer_id)|first %}
                                {% set receiver = all_users|selectattr('id', 'equalto', settlement.receiver_id)|first %}
                                <li class="flex justify-between items-center py-1 sm:py-2 border-b border-gray-100 last:border-b-0 text-xs sm:text-sm">
                                    <span class="text-gray-700"><i class="fas fa-user mr-1 text-gray-500"></i> {{ payer.username if payer else 'Unknown' }} paid <i class="fas fa-user mr-1 text-gray-500"></i> {{ receiver.username if receiver else 'Unknown' }}</span>
                                    <span class="font-bold text-green-600">₹{{ settlement.amount }}</span>
                                </li>
                                {% else %}
                                <li class="text-gray-400 text-xs sm:text-sm py-1 sm:py-2">No settlements yet.</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="group-actions flex flex-col gap-2 sm:gap-3">
                            <!-- Settlement Actions -->
                            {% for owe in group.owes %}
                                {% if owe.debtor.username == username %}
                                    {% set creditor_user = all_users|selectattr('username', 'equalto', owe.creditor.username)|first %}
                                    {% if creditor_user and creditor_user.upi_id %}
                                        <div class="bg-blue-50 p-3 sm:p-4 rounded-lg border border-blue-100 text-center">
                                            <a href="upi://pay?pa={{ creditor_user.upi_id }}&pn={{ creditor_user.username }}&am={{ owe.amount }}&tn=SplitEase+Payment"
                                               target="_blank" class="text-blue-700 font-bold hover:underline text-xs sm:text-sm block mb-2">
                                                Pay {{ creditor_user.username }} ₹{{ owe.amount }} via UPI
                                            </a>
                                            <div class="text-xs text-gray-500 mb-2">
                                                (UPI links work only on mobile. Or scan QR below:)
                                            </div>
                                            <img src="https://chart.googleapis.com/chart?cht=qr&chs=160x160&chl=upi://pay?pa={{ creditor_user.upi_id }}&pn={{ creditor_user.username }}&am={{ owe.amount }}&tn=SplitEase+Payment"
                                                 alt="UPI QR Code" class="mx-auto mt-2 rounded-lg shadow-sm w-24 h-24 sm:w-32 sm:h-32">
                                        </div>
                                    {% else %}
                                        <div class="bg-yellow-50 p-3 sm:p-4 rounded-lg border border-yellow-100 text-center">
                                            <p class="text-yellow-700 text-xs sm:text-sm">You owe {{ owe.creditor.username }} ₹{{ owe.amount }}</p>
                                            <p class="text-yellow-600 text-xs mt-1">Ask them to add their UPI ID</p>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                            
                            <!-- Add Expense Button -->
                            <button onclick="toggleForm('expense-form-{{ group.id }}')" class="group-action-btn w-full bg-purple-500 text-white py-2 rounded-lg font-semibold hover:bg-purple-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm sm:text-base">
                                <i class="fas fa-plus-circle"></i> <span>Add Expense</span>
                            </button>
                            <form id="expense-form-{{ group.id }}" method="post" action="/dashboard/add-expense" class="hidden flex flex-col gap-2 p-3 bg-gray-50 rounded-lg border border-gray-200" onsubmit="this.querySelector('button[type=submit]').disabled=true;">
                                <input type="hidden" name="group_id" value="{{ group.id }}">
                                <input type="text" name="description" placeholder="Reason" required
                                       class="px-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-purple-300 focus:border-purple-500 text-xs sm:text-sm">
                                <input type="number" name="amount" placeholder="Amount" step="0.01" min="0" required
                                       class="px-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-purple-300 focus:border-purple-500 text-xs sm:text-sm">
                                <button type="submit" class="bg-purple-600 text-white py-2 rounded-md font-semibold hover:bg-purple-700 transition-colors duration-200 text-xs sm:text-sm flex items-center justify-center space-x-2">
                                    <i class="fas fa-check"></i> <span>Add</span>
                                </button>
                            </form>
                            
                            <!-- Invite Friend Button -->
                            <button onclick="toggleForm('invite-form-{{ group.id }}')" class="group-action-btn w-full bg-indigo-500 text-white py-2 rounded-lg font-semibold hover:bg-indigo-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm sm:text-base">
                                <i class="fas fa-user-plus"></i> <span>Invite Friend</span>
                            </button>
                            <form id="invite-form-{{ group.id }}" method="post" action="/dashboard/invite-user" class="hidden flex flex-col gap-2 p-3 bg-gray-50 rounded-lg border border-gray-200" onsubmit="this.querySelector('button[type=submit]').disabled=true;">
                                <input type="hidden" name="group_id" value="{{ group.id }}">
                                <input type="text" name="username" placeholder="Friend's username" required
                                       class="px-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-indigo-300 focus:border-indigo-500 text-xs sm:text-sm">
                                <button type="submit" class="bg-indigo-600 text-white py-2 rounded-md font-semibold hover:bg-indigo-700 transition-colors duration-200 text-xs sm:text-sm flex items-center justify-center space-x-2">
                                    <i class="fas fa-paper-plane"></i> <span>Invite</span>
                                </button>
                            </form>
                            
                            <!-- Delete Group Button -->
                            <button onclick="showDeleteConfirm('delete-form-{{ group.id }}')" class="group-action-btn w-full bg-red-500 text-white py-2 rounded-lg font-semibold hover:bg-red-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm sm:text-base">
                                <i class="fas fa-trash"></i> <span>Delete Group</span>
                            </button>
                            <!-- The delete form will be submitted via the modal's confirm button -->
                            <form id="delete-form-{{ group.id }}" method="post" action="/dashboard/delete-group" class="hidden">
                                <input type="hidden" name="group_id" value="{{ group.id }}">
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8 sm:py-12">
                    <i class="fas fa-users text-gray-300 text-4xl sm:text-6xl mb-4"></i>
                    <h3 class="text-lg sm:text-xl font-semibold text-gray-600 mb-2">No Groups Yet</h3>
                    <p class="text-gray-500 mb-4 sm:mb-6 text-sm sm:text-base">Create your first group to start splitting expenses with friends!</p>
                </div>
                {% endif %}
                
                <!-- Add Group Form -->
                <form method="post" action="/dashboard/add-group" class="add-group-form flex flex-col sm:flex-row gap-3 mt-6 sm:mt-8 bg-white p-4 sm:p-6 rounded-lg shadow-sm border border-gray-100">
                    <input type="text" name="group_name" placeholder="New group name" required
                           class="flex-1 px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-500 transition-all duration-200 w-full sm:w-auto text-sm sm:text-base">
                    <button type="submit" class="px-4 sm:px-6 py-2 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 w-full sm:w-auto flex items-center justify-center space-x-2 text-sm sm:text-base">
                        <i class="fas fa-plus"></i> <span>Add Group</span>
                    </button>
                </form>
            </div>

            <!-- Recent Expenses Section -->
            <div class="expenses">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-4 sm:mb-5 text-center">Recent Expenses</h2>
                {% if expenses %}
                <div class="expenses-list flex flex-col items-center gap-3 sm:gap-4">
                    {% for expense in expenses %}
                    <div class="expense-card bg-white p-4 sm:p-5 rounded-xl shadow-md border border-gray-100 w-full max-w-sm sm:max-w-xl transform hover:scale-[1.01] transition-transform duration-200"
                         title="Expense by {{ expense.payer.username }}" aria-label="Expense Card">
                        <div class="expense-header flex justify-between items-center mb-2 sm:mb-3 pb-2 sm:pb-3 border-b border-gray-100">
                            <span class="expense-payer text-base sm:text-lg font-semibold text-gray-800 flex items-center space-x-2">
                                <i class="fas fa-user text-purple-500"></i> <span>{{ expense.payer.username }}</span>
                            </span>
                            <span class="expense-amount text-xl sm:text-2xl font-bold text-purple-600">₹{{ expense.amount }}</span>
                        </div>
                        <div class="expense-body text-xs sm:text-sm text-gray-600 flex flex-col space-y-1">
                            <span class="expense-group flex items-center space-x-2">
                                <i class="fas fa-users text-gray-500"></i> <span>{{ expense.group.name }}</span>
                            </span>
                            <span class="expense-reason flex items-center space-x-2">
                                <i class="fas fa-comment-dots text-gray-500"></i> <span>{{ expense.description }}</span>
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8 sm:py-12">
                    <i class="fas fa-receipt text-gray-300 text-4xl sm:text-6xl mb-4"></i>
                    <h3 class="text-lg sm:text-xl font-semibold text-gray-600 mb-2">No Recent Expenses</h3>
                    <p class="text-gray-500 text-sm sm:text-base">Add some expenses to your groups to see them here!</p>
                </div>
                {% endif %}
            </div>
        </main>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white p-6 sm:p-8 rounded-lg shadow-xl max-w-sm w-full text-center">
            <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4">Confirm Action</h3>
            <p class="text-gray-600 mb-4 sm:mb-6 text-sm sm:text-base" id="modalMessage">Are you sure you want to proceed?</p>
            <div class="flex justify-center space-x-3 sm:space-x-4">
                <button id="cancelButton" class="px-4 sm:px-6 py-2 bg-gray-300 text-gray-800 rounded-lg font-semibold hover:bg-gray-400 transition-colors duration-200 text-sm sm:text-base">
                    Cancel
                </button>
                <button id="confirmButton" class="px-4 sm:px-6 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors duration-200 text-sm sm:text-base">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <script>
        // Function to toggle form visibility
        function toggleForm(id) {
            const el = document.getElementById(id);
            if (el) {
                el.classList.toggle('hidden');
            }
        }

        // Custom confirmation modal logic
        let currentFormToSubmit = null;

        function showDeleteConfirm(formId) {
            const modal = document.getElementById('confirmationModal');
            const modalMessage = document.getElementById('modalMessage');
            const confirmButton = document.getElementById('confirmButton');
            const cancelButton = document.getElementById('cancelButton');

            modalMessage.textContent = 'Are you sure you want to delete this group? This action cannot be undone.';
            currentFormToSubmit = document.getElementById(formId);

            modal.classList.remove('hidden');

            confirmButton.onclick = () => {
                if (currentFormToSubmit) {
                    currentFormToSubmit.submit();
                }
                modal.classList.add('hidden');
            };

            cancelButton.onclick = () => {
                modal.classList.add('hidden');
                currentFormToSubmit = null;
            };

            // Close modal if clicking outside
            modal.onclick = (event) => {
                if (event.target === modal) {
                    modal.classList.add('hidden');
                    currentFormToSubmit = null;
                }
            };
        }
    </script>
</body>
</html>
